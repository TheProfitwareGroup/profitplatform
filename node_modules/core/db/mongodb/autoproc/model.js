var
    db = require('mongoose'),
    Schema = db.Schema,
    ObjectId = Schema.ObjectId;

var autoprocDescription = {
    STATE_PLAN: 0,
    STATE_EXEC: 1,
    STATE_DONE: 2,
    STATE_FAIL: 3
};

var autoprocModel = null;

autoprocDescription.paramsSchema = new Schema({
    param: { type: String }
});

autoprocDescription.retvalSchema = new Schema({
    param: { type: String },
    value: { type: String }
});

autoprocDescription.autoprocSchema = new Schema({
    id: ObjectId,
    name: { type: String },
    params: { type: JSON },
    dateregex: { type: String },
    state: { type: Number, min: autoprocDescription.STATE_PLAN, max: autoprocDescription.STATE_FAIL },
    retval: { type: JSON },
    lastmatch: { type: String },
    redo: { type: Boolean }
});

db.model('autoprocModel', autoprocDescription.autoprocSchema);
autoprocModel = db.model('autoprocModel');

module.exports = exports = {
    description: autoprocDescription,
    model: autoprocModel
};