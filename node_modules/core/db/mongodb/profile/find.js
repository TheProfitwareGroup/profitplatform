var event = require('events').EventEmitter;

module.exports = exports = function(i, params, result) {
	var model = i.model,
		t = [];
	ev = new event();
	ev.on('tryexit', function(params) {
		model.findOne({ name : params.name }, function(err, obj){
			if(err || (obj == undefined)) {
				result('Cannot find profile ' + params.name, []);
			} else {
				t = t.concat([], obj.schemas);
				if ( obj.extends != undefined ) {
					ev.emit('tryexit', { name : obj.extends } );
				} else {
					result(null, t);
				}
			}
		});
	});
	ev.emit('tryexit', params);
};