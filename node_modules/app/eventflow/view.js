var
    Sync = require('sync'),
    rpc = require('core/rpc.js'),
    options = require('options.js');

var main = function (sess) {
    if (sess.defaultPageStructure === undefined) {
        var apikey = rpc.local.sync(rpc, 'platform.common.getsession', ['', 'eventflow', options.eventflowkey]);
        sess.defaultPageStructure = rpc.local.sync(rpc, 'app.eventflow.web.page.find', [apikey]);
    }
    return JSON.parse(JSON.stringify(sess.defaultPageStructure));
}.async();

module.exports = exports = {
    main: main
};