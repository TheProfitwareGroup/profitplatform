var
	Sync = require('sync'),
	rpc = require('core/rpc');

var schema = function(params) {
	var
		appsrv = params.appsrv,
		pageStructure = params.pageStructure,
		parsedUrl = params.parsedUrl,
		sess = params.sess;
	pageStructure.pFind('platform.stats').time = rpc.local.sync(rpc, 'platform.common.heartbeat', [sess.apikey]);
	pageStructure.pFind('platform.stats').sessionScroller = 
		appsrv.page.sync(appsrv, 'scroller', { table : {
			head : [{
				name : 'session',
				title : 'Идентификатор сессии'
			},
			{
				name : 'username',
				title : 'Имя пользователя'
			},
			{
				name : 'date',
				title : 'Дата'
			}],
			data : rpc.local.sync(rpc, 'app.eventflow.web.platform.session.find', [sess.apikey])
		} } );
	pageStructure.pFind('platform.stats').schemas = 
		rpc.local.sync(rpc, 'platform.common.schemalist', [sess.apikey]);
	
	pageStructure.pFind('leftmenu').menu
		.find('title', 'ProfitPlatform').menu
		.find('href', '#platform.stats').active = true;
	pageStructure.pFind('content').content = appsrv.page.sync(appsrv, 'platform.stats', pageStructure.pFind('platform.stats'));
	return pageStructure;
}.async();

module.exports = exports = schema;