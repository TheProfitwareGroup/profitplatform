var schema = require('core/schema.js').initme(__filename),
    db = require('core/db.js'),
    jsonrpc = require('core/jsonrpc.js'),
    sprintf = require('sprintf').sprintf,
    options = require('options.js'),
    Sync = require('sync');

var main = {};

/**
 * Schema: [app.eventflow.web]doctype.find
 *
 * Returns pages structure
 *
 * @return {Object}
 */

main[schema] = function (apikey, params) {
    try {
        var schemaParams = {
            sysid: sprintf('EventFlow [ProfitPlatform %s] (%s:%s)',
                options.version, options.platform_host, options.platform_port) };

        if (params && params.sysid)
            schemaParams.sysid = params.sysid;
        return db.emit.sync(db, 'schema', '[app.eventflow]doctype.find', schemaParams);
    } catch (e) {
        throw new Error(jsonrpc.DATABASE_ERROR);
    }
    ;
}.async();

exports.main = main;