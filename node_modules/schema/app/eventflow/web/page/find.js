var schema = require('core/schema.js').initme(__filename),
	db = require('core/db.js'),
    jsonrpc = require('core/jsonrpc.js'),
    Sync = require('sync');

var main = {};

/**
 * Schema: [app.eventflow.web]page.find
 * 
 * Returns pages structure
 * 
 * @return {Object}
 */
 
main[schema] = function(apikey, result) {
	Sync(function(){
		try{
			return db.emit.sync(db, 'schema', '[app.eventflow.web]page.find', {});
		}catch(e){
			throw new Error(jsonrpc.DATABASE_ERROR);
		}
	}, result);
};

exports.main = main;
exports.install = function(installInfo){
	installInfo.eventflowPages.forEach(function(page){
		try{
			db.emit.future(db, 'schema', '[app.eventflow.web]page.add', page);
		}catch(e){}
	});
}.async();