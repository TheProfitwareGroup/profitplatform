/**
 * Module dependencies
 */

var schema = require('core/schema.js').initme(__filename);
var jsonrpc = require('core/jsonrpc.js'),
    db = require('core/db.js'),
    Sync = require('sync');

var main = {};

/**
 * Schema: app.eventflow.document.status
 * 
 * Get document status by reference
 * 
 * @param {Object} document
 * @return {Object}
 * @api public
 */

main[schema] = function(apikey, document, result) {
	Sync(function(){
		var doc = {};
		try{
			doc = db.emit.sync(db, 'schema', '[app.eventflow]document.find', document);
			doc.document = undefined;
		}catch(e){
			doc.status = 'error';
			doc.error = e;
		}
		
		doc.ref = doc.ref ? doc.ref : '';
		doc.history = doc.history ? doc.history : [];
		doc.date_ts = doc.date_ts ? doc.date_ts : 0;
		doc.doctype = doc.doctype ? doc.doctype : '';
		doc.sysid = doc.sysid ? doc.sysid : '';
		doc.status = doc.status ? doc.status : '';
		return doc;
	}, result);
};

exports.main = main;