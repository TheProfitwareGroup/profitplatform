var options = require('options.js')

var schema = require('core/schema.js').initme(__filename);
var db = require('core/db.js'),
    jsonrpc = require('core/jsonrpc.js'),
    ldap = require('ldapjs');

var main = {};
var opts = { 
		scope : 'sub', 
		filter : '(&(objectClass=organizationalPerson)(gidNumber=9000))' 
	},
	lopts = {
		url : 'ldap://db.profitware.ru:389',
		base : 'cn=users,dc=profitware,dc=ru'
	};

/**
 * Schema: app.profitware.company.users.find
 * 
 * Gets users from The Profitware Group LDAP
 * 
 * @return {Object}
 */

main[schema] = function(apikey, result) {
	var client = ldap.createClient({ url : lopts.url });
	var larr = new Array();
	client.search(lopts.base, opts, function(err, res) {
		res.on('searchEntry', function(entry) {
			larr.push(entry.object);
		});
		res.on('error', function(err) {
			result(err, []);
		});
		res.on('end', function(xresult) {
			result(null, larr);
		});
	});
};


exports.main = main;