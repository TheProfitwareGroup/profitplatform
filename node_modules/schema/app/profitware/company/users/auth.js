var options = require('options.js')

var schema = require('core/schema.js').initme(__filename);
var db = require('core/db.js'),
    jsonrpc = require('core/jsonrpc.js'),
    ldap = require('ldapjs');

var main = {};
var opts = { 
		scope : 'sub', 
		filter : '(&(objectClass=organizationalPerson)(gidNumber=9000))' 
	},
	lopts = {
		url : 'ldap://db.profitware.ru:389',
		base : 'cn=users,dc=profitware,dc=ru'
	};

/**
 * Schema: app.profitware.company.users.auth
 * 
 * Authentificates users from The Profitware Group LDAP
 * 
 * @return {Object}
 */

main[schema] = function(apikey, username, pwd, result) {
	var client = ldap.createClient({ url : lopts.url });
	var xresult = function(err, obj){
		client.unbind(function(err) {
			result(err, obj);
		});
	};
	client.bind('uid=' + username + ',' + lopts.base, pwd, function(err) {
		if(err){
			xresult(null, 'false');
		}else{
			xresult(null, 'true');
		}
	});
};


exports.main = main;