var options = require('options.js');
var schema = require('core/schema.js').initme(__filename);
var db = require('core/db.js'),
    jsonrpc = require('core/jsonrpc.js');

var main = {};

/**
 * Schema: platform.admin.getinfo
 *
 * Returns platform options
 *
 * @return {Object}
 */

main[schema] = function (apikey, result) {
    db.emit('schema', 'session.find', {session: apikey}, function (err, obj) {
        if (err || (obj === null)) {
            result(jsonrpc.INVALID_APIKEY);
        } else {
            var ret = {
                'version': options.version,
                'debug': options.debug
            };
            ret.user = obj.user;
            ret.session = obj.session;
            result(null, ret);
        }
    });
};

exports.main = main;